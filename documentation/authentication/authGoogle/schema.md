## 1. Ініціація входу (фронтенд)

- Користувач натискає кнопку "Продовжити з Google" у модальному вікні (`SocialAuthFooter.tsx`).
- Фронтенд викликає функцію з хука `useGoogleSignIn`, яка ініціалізує авторизацію через Google за допомогою Supabase.
- Supabase генерує URL для входу через Google OAuth із параметром prompt: `select_account`, щоб завжди показувати вікно вибору акаунта, і перенаправляє користувача на сторінку авторизації Google.

## 2. Авторизація через Google

- Користувач входить у свій Google-акаунт і дає згоду на доступ до даних (email, профіль).
- Google перенаправляє користувача назад на твій додаток за URL, вказаним у redirectTo (`window.location.origin`), який налаштовано у Supabase Dashboard (`Authentication → URL Configuration`).

## 3. Обробка сесії (фронтенд)

- Після повернення на додаток хук `useAuthCheck` автоматично викликає `supabase.auth.getSession()`, щоб перевірити, чи створена сесія Supabase.
- Якщо сесія створена, `useAuthCheck` отримує об’єкт user із `Supabase Auth` і відправляє його у API-роут `/api/user/save` для збереження або оновлення користувача у базі даних.

## 4. Обробка на бекенді (`/api/user/save`)

- Бекенд через роут `/api/user/save` отримує дані користувача від фронтенду.
- Бекенд створює або оновлює користувача в базі даних (`public.User` у Prisma) з відповідним `supabaseId`, який отримується з `user.id` (Supabase Auth UUID).
- Бекенд генерує власні токени (`accessToken` і `refreshToken`) за допомогою функції `generateTokens`, використовуючи `userId`, `email` і `role` користувача.
- Бекенд повертає об’єкт із даними користувача (`user`), токенами (`accessToken`, `refreshToken`) і типом токена (`tokenType`: "Bearer").

## 5. Обробка на фронтенді

- Фронтенд отримує відповідь від `/api/user/save`, яка містить оновлені дані користувача та власні токени.
- Дані користувача (`user`) і токени (`accessToken`, `refreshToken`, `tokenType`) зберігаються у стані `authStore` (Zustand).
- Користувач вважається авторизованим, і фронтенд показує відповідний інтерфейс.

## 6. Безпека

- Уся логіка автентифікації (збереження користувача, генерація токенів) відбувається на бекенді, щоб уникнути витоку чутливих даних (`JWT_SECRET`).
- Токени зберігаються у стані `authStore` (Zustand) і передаються у запитах через заголовок `Authorization`. Для захисту від XSS використовуються стандартні практики.
- Токени Supabase не використовуються для авторизації у додатку; вони потрібні лише для взаємодії з Supabase Auth (наприклад, для завершення сесії).
